FROM php7.3-fpm

COPY --from=composer usrbincomposer usrbincomposer

RUN apt-get update && apt-get install -y 
  gzip 
  libbz2-dev 
  libfreetype6-dev 
  libicu-dev 
  libjpeg62-turbo-dev 
  libmcrypt-dev 
  libpng-dev 
  libsodium-dev 
  libssh2-1-dev 
  libxslt1-dev 
  libzip-dev 
  lsof 
  default-mysql-client 
  zip

RUN docker-php-ext-configure 
  gd --with-freetype-dir=usrinclude --with-jpeg-dir=usrinclude

RUN docker-php-ext-install 
  bcmath 
  bz2 
  calendar 
  exif 
  gd 
  gettext 
  intl 
  mbstring 
  mysqli 
  opcache 
  pcntl 
  pdo_mysql 
  soap 
  sockets 
  sodium 
  sysvmsg 
  sysvsem 
  sysvshm 
  xsl 
  zip

RUN mv $PHP_INI_DIRphp.ini-development $PHP_INI_DIRphp.ini

RUN groupadd -g 1000 app 
 && useradd -g 1000 -u 1000 -d varwww -s binbash app
RUN mkdir -p varwwwhtml 
   && chown -R appapp varwww

USER appapp
VOLUME varwww
WORKDIR varwwwhtml
